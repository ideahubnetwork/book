# 架构优化和索引

优化需要权衡取舍。比如，添加索引会加快读取速度，却会减慢跟新速度。

## 优化数据类型

+ 根据粒度和需要设置合适大小的数据类型
+ 使用内置的日期和时间类型存储日期时间，使用整数存储IP地址
+ 尽量避免NULL，NULL需要更大的存储空间

### 整数

根据实际情况选择有符号和无符号的类型。

int(1) 和 int(11) 是一样的，只不过在交互工具上显示字符的个数不同。

### 实数

`float` 和 `decimal`

### 字符串

+ varchar 和 char

`varchar` 会使用额外的1到2字节去存储值得长度，如 varchar(10) 占用了11个字节，而 varchar(1000) 占用1002个字节。
当最大长度远大于平均长度，并且很少更新的时候，适合使用 `varchar`。

mysql 会保留字符串末尾的空格，但其他 DBMS 不一定。

`char`。长度大致相似且比较短的时候，适合使用 `char` 。

mysql 不会保留字符串末尾的空格，但其他 DBMS 不一定。

+ blob 和 text

`blob` 保存二进制数据，且没有字符集和排序规则。

+ 使用enum代替字符串

使用enum代替字符串具有更好的可读性，并且存储空间较小，而且容易知道允许存储的值有哪些。但正由于此，每当添加字符串时，都需要 alter table。
另外，由于实际存储的是整数，所以不要使用enum来代替整数，另外，也不能按照字符串的顺序来排序。

### 日期和时间类型

`datetime` 占用8字节的存储空间，从1001年到9999年，精度为秒，与时区无关。

`timestamp` 占用4字节的存储空间，保存了自1970年1月1日的秒数。

如果需要保存毫秒数，可以使用 `bigint` 或者 `double`。

## 索引基础知识

### 索引类型

有很多类型的索引，在存储引擎层实现。

+ B-Tree 索引

很多时候，叫 `B-Tree` 索引不一定是 `B-Tree` 索引，有可能是 `B+Tree`，也有可能是 `T-Tree`。

B-Tree 意味着数据存储是有序的，且每个叶子节点到根的距离大致一样（平衡因子较小）。
